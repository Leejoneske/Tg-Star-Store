 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tg Star Store - User Feedback Survey</title>
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #f8f9fa;
            --accent-color: #ff6b6b;
            --text-color: #333;
            --light-text: #666;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            color: var(--text-color);
            line-height: 1.6;
            background-color: #f5f7ff;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background-color: white;
            box-shadow: var(--shadow);
            border-radius: 10px;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 2rem;
        }

        h2 {
            color: var(--primary-color);
            margin: 1.5rem 0 1rem;
            font-size: 1.3rem;
        }

        .subtitle {
            color: var(--light-text);
            margin-bottom: 1rem;
        }

        .welcome-screen,
        .thank-you-screen,
        .already-completed-screen {
            text-align: center;
            padding: 2rem 1rem;
            display: none;
        }

        .welcome-screen.active,
        .thank-you-screen.active,
        .already-completed-screen.active,
        .survey-form.active {
            display: block;
        }

        .survey-form {
            display: none;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #3a5bf0;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: #e9ecef;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--secondary-color);
            border-radius: 5px;
            margin: 1rem 0 2rem;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-container {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .question {
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        input[type="radio"], 
        input[type="checkbox"] {
            accent-color: var(--primary-color);
            width: 16px;
            height: 16px;
        }

        textarea,
        input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-top: 0.5rem;
            font-size: 1rem;
            resize: vertical;
        }

        textarea:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 107, 255, 0.2);
        }

        .required {
            color: var(--accent-color);
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .note-box {
            background-color: var(--secondary-color);
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 4px 4px 0;
        }

        .error-message {
            color: var(--accent-color);
            font-size: 0.9rem;
            margin-top: 0.25rem;
            display: none;
        }

        .success-icon {
            font-size: 3rem;
            color: #28a745;
            margin-bottom: 1rem;
        }

        .warning-icon {
            font-size: 3rem;
            color: #ffc107;
            margin-bottom: 1rem;
        }

        .screen-icon {
            margin-bottom: 1.5rem;
            font-size: 4rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
                margin: 1rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            .btn {
                padding: 0.6rem 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Tg Star Store - User Feedback</h1>
            <p class="subtitle">Help us improve your experience</p>
        </header>

        <!-- Welcome Screen -->
        <div class="welcome-screen active" id="welcomeScreen">
            <div class="screen-icon">ðŸ“Š</div>
            <h2>We Value Your Feedback!</h2>
            <p>This short survey will help us understand what you love about Star Store and what features you'd like to see in our next update.</p>
            <p>It will take approximately 3-5 minutes to complete.</p>
            <div class="btn-container">
                <button class="btn btn-primary" id="startSurvey">Start Survey</button>
                <button class="btn btn-secondary" id="declineSurvey">Maybe Later</button>
            </div>
            <div class="note-box">
                <p>Your feedback is completely anonymous and will be used to improve our services. Thank you for your time!</p>
            </div>
        </div>

        <!-- Already Completed Screen -->
        <div class="already-completed-screen" id="alreadyCompletedScreen">
            <div class="screen-icon warning-icon">âœ“</div>
            <h2>You've Already Completed This Survey</h2>
            <p>It looks like you've already provided your feedback. We appreciate your contribution!</p>
            <p>We're working on implementing new features based on user feedback.</p>
            <div class="btn-container">
                <button class="btn btn-secondary" id="takeAgainBtn">Take Survey Again</button>
            </div>
        </div>

        <!-- Survey Form -->
        <div class="survey-form" id="surveyForm">
            <div class="progress-bar">
                <div class="progress-bar-fill" id="progressBarFill"></div>
            </div>

            <form id="starStoreSurvey">
                <!-- Question 1 -->
                <div class="question-container">
                    <p class="question">1. How often do you use Star Store? <span class="required">*</span></p>
                    <div class="options-container">
                        <label class="option">
                            <input type="radio" name="usageFrequency" value="daily" required>
                            Daily
                        </label>
                        <label class="option">
                            <input type="radio" name="usageFrequency" value="weekly">
                            Weekly
                        </label>
                        <label class="option">
                            <input type="radio" name="usageFrequency" value="monthly">
                            Monthly
                        </label>
                        <label class="option">
                            <input type="radio" name="usageFrequency" value="rarely">
                            Rarely
                        </label>
                        <label class="option">
                            <input type="radio" name="usageFrequency" value="firstTime">
                            This is my first time
                        </label>
                    </div>
                    <div class="error-message" id="usageFrequency-error">Please select an option</div>
                </div>

                <!-- Question 2 -->
                <div class="question-container">
                    <p class="question">2. What features do you like the most about Star Store? (Select all that apply)</p>
                    <div class="options-container">
                        <label class="option">
                            <input type="checkbox" name="favoriteFeatures" value="easeOfUse">
                            Ease of use
                        </label>
                        <label class="option">
                            <input type="checkbox" name="favoriteFeatures" value="userInterface">
                            User interface
                        </label>
                        <label class="option">
                            <input type="checkbox" name="favoriteFeatures" value="transactionSpeed">
                            Transaction speed
                        </label>
                        <label class="option">
                            <input type="checkbox" name="favoriteFeatures" value="telegram">
                            Telegram integration
                        </label>
                        <label class="option">
                            <input type="checkbox" name="favoriteFeatures" value="security">
                            Security features
                        </label>
                    </div>
                </div>

                <!-- Question 3 -->
                <div class="question-container">
                    <p class="question">3. What features would you like to see in our next update? <span class="required">*</span></p>
                    <textarea name="desiredFeatures" rows="3" required placeholder="Please share your ideas..."></textarea>
                    <div class="error-message" id="desiredFeatures-error">Please provide your feedback</div>
                </div>

                <!-- Question 4 -->
                <div class="question-container">
                    <p class="question">4. How would you rate your overall experience with Star Store? <span class="required">*</span></p>
                    <div class="options-container">
                        <label class="option">
                            <input type="radio" name="overallRating" value="5" required>
                            Excellent (5/5)
                        </label>
                        <label class="option">
                            <input type="radio" name="overallRating" value="4">
                            Good (4/5)
                        </label>
                        <label class="option">
                            <input type="radio" name="overallRating" value="3">
                            Average (3/5)
                        </label>
                        <label class="option">
                            <input type="radio" name="overallRating" value="2">
                            Below Average (2/5)
                        </label>
                        <label class="option">
                            <input type="radio" name="overallRating" value="1">
                            Poor (1/5)
                        </label>
                    </div>
                    <div class="error-message" id="overallRating-error">Please select a rating</div>
                </div>

                <!-- Question 5 -->
                <div class="question-container">
                    <p class="question">5. If you selected below average or poor, please tell us why:</p>
                    <textarea name="improvementFeedback" rows="3" placeholder="Please explain what we can improve..."></textarea>
                </div>

                <!-- Question 6 -->
                <div class="question-container">
                    <p class="question">6. Have you encountered any technical issues while using Star Store?</p>
                    <div class="options-container">
                        <label class="option">
                            <input type="radio" name="technicalIssues" value="yes">
                            Yes
                        </label>
                        <label class="option">
                            <input type="radio" name="technicalIssues" value="no">
                            No
                        </label>
                    </div>
                    <div id="technicalIssuesDetails" style="display: none; margin-top: 1rem;">
                        <p>Please describe the issues you've encountered:</p>
                        <textarea name="technicalIssuesDetails" rows="3" placeholder="Describe the technical issues..."></textarea>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button type="button" class="btn btn-secondary" id="cancelSurvey">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submitSurvey">Submit Feedback</button>
                </div>
            </form>
        </div>

        <!-- Thank You Screen -->
        <div class="thank-you-screen" id="thankYouScreen">
            <div class="screen-icon success-icon">âœ“</div>
            <h2>Thank You for Your Feedback!</h2>
            <p>Your responses have been submitted successfully. We appreciate your time and valuable input.</p>
            <p>We're constantly working to improve Star Store based on user feedback like yours.</p>
            <div class="btn-container">
                <button class="btn btn-primary" id="returnToAppBtn">Return to App</button>
            </div>
        </div>
    </div>

    <script>
// DOM Elements
const welcomeScreen = document.getElementById('welcomeScreen');
const surveyForm = document.getElementById('surveyForm');
const thankYouScreen = document.getElementById('thankYouScreen');
const alreadyCompletedScreen = document.getElementById('alreadyCompletedScreen');
const progressBarFill = document.getElementById('progressBarFill');
const startSurveyBtn = document.getElementById('startSurvey');
const declineSurveyBtn = document.getElementById('declineSurvey');
const cancelSurveyBtn = document.getElementById('cancelSurvey');
const takeAgainBtn = document.getElementById('takeAgainBtn');
const returnToAppBtn = document.getElementById('returnToAppBtn');
const starStoreSurvey = document.getElementById('starStoreSurvey');
const technicalIssuesRadios = document.getElementsByName('technicalIssues');
const technicalIssuesDetails = document.getElementById('technicalIssuesDetails');

// Check if user has already completed the survey
const checkSurveyStatus = () => {
    const hasCompletedSurvey = localStorage.getItem('starStoreSurveyCompleted');
    if (hasCompletedSurvey === 'true') {
        welcomeScreen.classList.remove('active');
        alreadyCompletedScreen.classList.add('active');
    }
};

// Initialize the survey form
const initSurvey = () => {
    checkSurveyStatus();
    updateProgressBar();

    // Set up event listeners for technical issues radio buttons
    for (const radio of technicalIssuesRadios) {
        radio.addEventListener('change', function() {
            if (this.value === 'yes') {
                technicalIssuesDetails.style.display = 'block';
            } else {
                technicalIssuesDetails.style.display = 'none';
            }
        });
    }

    // Load saved progress
    loadProgress();
};

// Update progress bar based on form completion
const updateProgressBar = () => {
    const form = document.getElementById('starStoreSurvey');
    const requiredFields = form.querySelectorAll('[required]');
    const totalRequired = requiredFields.length;
    let completedCount = 0;

    requiredFields.forEach(field => {
        if (field.type === 'radio') {
            const radioGroup = document.getElementsByName(field.name);
            const isChecked = Array.from(radioGroup).some(radio => radio.checked);
            if (isChecked) {
                completedCount++;
            }
        } else {
            if (field.value.trim() !== '') {
                completedCount++;
            }
        }
    });

    const progressPercentage = (completedCount / totalRequired) * 100;
    progressBarFill.style.width = `${progressPercentage}%`;
};

// Save current progress to localStorage
const saveProgress = () => {
    const formData = new FormData(starStoreSurvey);
    const formEntries = {};

    for (const [key, value] of formData.entries()) {
        if (formEntries[key]) {
            if (!Array.isArray(formEntries[key])) {
                formEntries[key] = [formEntries[key]];
            }
            formEntries[key].push(value);
        } else {
            formEntries[key] = value;
        }
    }

    localStorage.setItem('starStoreSurveyProgress', JSON.stringify(formEntries));
    updateProgressBar();
};

// Load saved progress from localStorage
const loadProgress = () => {
    const savedProgress = localStorage.getItem('starStoreSurveyProgress');
    if (!savedProgress) return;

    const formEntries = JSON.parse(savedProgress);

    for (const [key, value] of Object.entries(formEntries)) {
        const elements = document.getElementsByName(key);
        if (elements.length > 0) {
            const element = elements[0];

            if (element.type === 'checkbox' || element.type === 'radio') {
                if (Array.isArray(value)) {
                    value.forEach(val => {
                        const checkbox = Array.from(elements).find(el => el.value === val);
                        if (checkbox) checkbox.checked = true;
                    });
                } else {
                    const radio = Array.from(elements).find(el => el.value === value);
                    if (radio) radio.checked = true;
                }
            } else {
                element.value = value;
            }

            // Show technical issues details if "yes" is selected
            if (key === 'technicalIssues' && value === 'yes') {
                technicalIssuesDetails.style.display = 'block';
            }
        }
    }

    updateProgressBar();
};

// Validate the form
const validateForm = () => {
    const form = document.getElementById('starStoreSurvey');
    const requiredFields = form.querySelectorAll('[required]');
    let isValid = true;

    // Reset all error messages
    document.querySelectorAll('.error-message').forEach(el => {
        el.style.display = 'none';
    });

    requiredFields.forEach(field => {
        if (field.type === 'radio') {
            const radioGroup = document.getElementsByName(field.name);
            const isChecked = Array.from(radioGroup).some(radio => radio.checked);
            
            if (!isChecked) {
                const errorEl = document.getElementById(`${field.name}-error`);
                if (errorEl) {
                    errorEl.style.display = 'block';
                    isValid = false;
                }
            }
        } else {
            if (field.value.trim() === '') {
                const errorEl = document.getElementById(`${field.name}-error`);
                if (errorEl) {
                    errorEl.style.display = 'block';
                    isValid = false;
                }
            }
        }
    });

    return isValid;
};

// Submit the form to backend
const submitSurvey = async (formData) => {
    try {
        const response = await fetch('/api/survey', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        
        return await response.json();
    } catch (error) {
        console.error('Error submitting survey:', error);
        throw error;
    }
};

// Event Listeners
startSurveyBtn.addEventListener('click', () => {
    welcomeScreen.classList.remove('active');
    surveyForm.classList.add('active');
});

declineSurveyBtn.addEventListener('click', () => {
    alert('Thank you for your time. You can take the survey later.');
});

cancelSurveyBtn.addEventListener('click', () => {
    if (confirm('Are you sure you want to cancel? Your progress will be saved.')) {
        saveProgress();
        surveyForm.classList.remove('active');
        welcomeScreen.classList.add('active');
    }
});

takeAgainBtn.addEventListener('click', () => {
    localStorage.removeItem('starStoreSurveyCompleted');
    alreadyCompletedScreen.classList.remove('active');
    welcomeScreen.classList.add('active');
});

returnToAppBtn.addEventListener('click', () => {
    alert('Redirecting to app...');
});

// Save progress when input changes
starStoreSurvey.addEventListener('input', saveProgress);

// Handle form submission
starStoreSurvey.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!validateForm()) {
        return;
    }
    
    const formData = new FormData(starStoreSurvey);
    const formEntries = {};
    
    for (const [key, value] of formData.entries()) {
        if (formEntries[key]) {
            if (!Array.isArray(formEntries[key])) {
                formEntries[key] = [formEntries[key]];
            }
            formEntries[key].push(value);
        } else {
            formEntries[key] = value;
        }
    }
    
    try {
        // Send to backend
        await submitSurvey(formEntries);
        
        // Mark survey as completed
        localStorage.setItem('starStoreSurveyCompleted', 'true');
        
        // Clear progress
        localStorage.removeItem('starStoreSurveyProgress');
        
        // Show thank you screen
        surveyForm.classList.remove('active');
        thankYouScreen.classList.add('active');
    } catch (error) {
        alert('There was an error submitting your feedback. Please try again later.');
    }
});

// Initialize the survey
document.addEventListener('DOMContentLoaded', initSurvey);
    </script>
</body>
</html>
