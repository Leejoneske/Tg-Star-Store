 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StarStore Support</title>
    <style>
        /* === AGGRESSIVELY HIDE ALL TAWK.TO ELEMENTS === */
        body:not(.ready) .tawk-min-container,
        body:not(.ready) .tawk-button,
        body:not(.ready) .tawk-bubble {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        /* === HIDE SCROLL DURING INIT === */
        body.init {
            overflow: hidden;
        }
    </style>
</head>
<body class="init">
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script>
        // ===== 1. BLOCK TAWK.TO VISIBILITY =====
        // Add instant-hide CSS before Tawk.to loads
        const blocker = document.createElement('style');
        blocker.innerHTML = `
            .tawk-min-container, 
            .tawk-button, 
            .tawk-bubble {
                display: none !important;
            }
        `;
        document.head.appendChild(blocker);

        // ===== 2. TELEGRAM USER DATA =====
        function getTelegramUser() {
            const tg = window.Telegram?.WebApp;
            return tg?.initDataUnsafe?.user || null;
        }

        // ===== 3. TAWK.TO CONFIG =====
        window.Tawk_API = window.Tawk_API || {};
        window.Tawk_LoadStart = new Date();
        
        // Critical settings to prevent UI flashes
        Tawk_API.autoDisplay = false;
        Tawk_API.hideWidgetOnLoad = true;

        Tawk_API.onLoad = function() {
            // Set visitor data
            const user = getTelegramUser();
            if (user) {
                Tawk_API.setVisitorData({
                    name: `TG:${user.id}`,
                    email: `${user.id}@telegram.starstore`,
                    telegramId: user.id
                });
            }

            // Mobile optimization
            const isMobile = window.innerWidth <= 768;
            
            // Configure before showing
            Tawk_API.setAttributes({
                theme: 'light',
                overlay: isMobile,
                hideBubble: true,
                mobileFullScreen: isMobile
            });

            // === CRITICAL: DELAYED VISIBILITY ===
            setTimeout(() => {
                // 1. Mark body as ready (allows Tawk.to elements to show)
                document.body.classList.add('ready');
                document.body.classList.remove('init');
                
                // 2. Force-show and maximize
                Tawk_API.showWidget();
                Tawk_API.maximize();
                
                // 3. Focus input field
                try {
                    Tawk_API.focus();
                } catch(e) { console.log('Focus not available yet'); }
            }, 500); // Safety delay
        };

        // ===== 4. LOAD TAWK.TO =====
        (function() {
            var s = document.createElement('script');
            s.async = true;
            s.src = 'https://embed.tawk.to/67ecff100a2d5b1907b51428/1inqs8mce';
            s.charset = 'UTF-8';
            s.setAttribute('crossorigin', '*');
            document.body.appendChild(s);
        })();
    </script>
</body>
</html>
