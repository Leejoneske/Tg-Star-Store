<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no, shrink-to-fit=no, viewport-fit=cover">
    <title>Referral Program - StarStore</title>
    <link rel="canonical" href="https://starstore.site/referral">
    <meta name="description" content="Earn 0.5 USDT per successful referral. Share your unique link and start earning today!">
    <meta property="og:title" content="StarStore Referral Program">
    <meta property="og:description" content="Earn 0.5 USDT per successful referral. Share your unique link and start earning today!">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/js/translations.js?v=4"></script>
    <link rel="icon" href="/favicon.png" type="image/png">
    <link rel="stylesheet" href="/css/theme.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
        }

        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        *:focus {
            outline: none !important;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            margin: 0 auto;
            background: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
            max-width: 600px;
            width: 100%;
        }

        .telegram-fullscreen .app-container {
            max-width: 100%;
            width: 100%;
            margin: 0;
            box-shadow: none;
            border-radius: 0;
        }

        .page-header {
            padding: 12px 20px;
            background: white;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
        }

        .page-header h1 {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
            color: #111827;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 12px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
            border: 1px solid #e2e8f0;
        }

        .stat-icon {
            font-size: 18px;
            margin-bottom: 6px;
            color: #667eea;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 11px;
            color: #6b7280;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .content-area {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            padding-bottom: 100px;
        }

        .section-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            color: #6b7280;
            margin-bottom: 8px;
            padding-left: 2px;
            margin-top: 12px;
        }

        .card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: #f9fafb;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .card:active {
            transform: scale(0.98);
            background: #f3f4f6;
        }

        .card-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .card-info h3 {
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
            margin: 0 0 2px 0;
        }

        .card-info p {
            font-size: 12px;
            color: #6b7280;
            margin: 0;
        }

        .card-arrow {
            width: 20px;
            height: 20px;
            color: #d1d5db;
            flex-shrink: 0;
        }

        .icon-purple { background: #e9d5ff; color: #9333ea; }
        .icon-blue { background: #dbeafe; color: #2563eb; }
        .icon-green { background: #dcfce7; color: #16a34a; }

        .referral-link-section {
            background: white;
            border-radius: 10px;
            padding: 12px;
            border: 1px solid #e5e7eb;
            margin-bottom: 12px;
        }

        .referral-link-display {
            background: #f3f4f6;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            word-break: break-all;
            color: #374151;
            margin-bottom: 10px;
            max-height: 80px;
            overflow-y: auto;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .btn {
            padding: 10px 14px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:active {
            transform: scale(0.95);
            opacity: 0.9;
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:active {
            transform: scale(0.95);
            background: #f9fafb;
        }

        .referral-item {
            background: white;
            border-radius: 10px;
            padding: 10px;
            border-left: 3px solid #10b981;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
        }

        .referral-item.pending {
            border-left-color: #f59e0b;
        }

        .referral-info h4 {
            font-weight: 600;
            color: #1f2937;
            margin: 0 0 2px 0;
            font-size: 13px;
        }

        .referral-info p {
            font-size: 11px;
            color: #6b7280;
            margin: 0;
        }

        .referral-amount {
            text-align: right;
        }

        .referral-amount .amount {
            font-weight: 700;
            color: #10b981;
            font-size: 14px;
        }

        .referral-amount .status {
            font-size: 10px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
        }

        .empty-state {
            text-align: center;
            padding: 30px 16px;
        }

        .empty-icon {
            font-size: 32px;
            margin-bottom: 8px;
            color: #cbd5e1;
        }

        .empty-state h3 {
            font-weight: 600;
            color: #1f2937;
            margin: 0 0 6px 0;
            font-size: 14px;
        }

        .empty-state p {
            color: #6b7280;
            font-size: 12px;
            margin: 0;
        }

        .how-it-works {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 8px;
        }

        .step-card {
            background: white;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .step-number {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
            margin: 0 auto 8px;
        }

        .step-card h4 {
            font-weight: 600;
            color: #1f2937;
            font-size: 13px;
            margin: 0 0 4px 0;
        }

        .step-card p {
            font-size: 11px;
            color: #6b7280;
            margin: 0;
        }

        /* Dark theme support */
        @media (prefers-color-scheme: dark) {
            body { background: #0f172a; }
            .app-container { background: #111827; box-shadow: none; }
            .stats-container { background: #1f2937; border-color: #374151; }
            .stat-card { background: #1f2937; border-color: #374151; }
            .stat-value { color: #f0f9ff; }
            .stat-label { color: #9ca3af; }
            .section-title { color: #9ca3af; }
            .content-area { background: #0f172a; }
            .card { background: #1f2937; border-color: #374151; }
            .card:active { background: #111827; }
            .card-info h3 { color: #e5e7eb; }
            .card-info p { color: #9ca3af; }
            .card-arrow { color: #4b5563; }
            .referral-link-section { background: #111827; border-color: #374151; }
            .referral-link-display { background: #1f2937; border-color: #4b5563; color: #e5e7eb; }
            .btn-secondary { background: #111827; color: #818cf8; border-color: #818cf8; }
            .referral-item { background: #111827; box-shadow: none; }
            .referral-info h4 { color: #e5e7eb; }
            .referral-info p { color: #9ca3af; }
            .referral-amount .status { color: #9ca3af; }
            .empty-state h3 { color: #e5e7eb; }
            .empty-state p { color: #9ca3af; }
            .step-card { background: #111827; border-color: #374151; }
            .step-card h4 { color: #e5e7eb; }
            .step-card p { color: #9ca3af; }
            .hero-section { background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%); }
        }

        [data-theme="dark"] body { background: #0f172a; }
        [data-theme="dark"] .app-container { background: #111827; }
        [data-theme="dark"] .stats-container { background: #1f2937; border-color: #374151; }
        [data-theme="dark"] .stat-card { background: #1f2937; border-color: #374151; }
        [data-theme="dark"] .stat-value { color: #f0f9ff; }
        [data-theme="dark"] .stat-label { color: #9ca3af; }
        [data-theme="dark"] .section-title { color: #9ca3af; }
        [data-theme="dark"] .content-area { background: #0f172a; }
        [data-theme="dark"] .card { background: #1f2937; border-color: #374151; }
        [data-theme="dark"] .card:active { background: #111827; }
        [data-theme="dark"] .card-info h3 { color: #e5e7eb; }
        [data-theme="dark"] .card-info p { color: #9ca3af; }
        [data-theme="dark"] .card-arrow { color: #4b5563; }
        [data-theme="dark"] .referral-link-section { background: #111827; border-color: #374151; }
        [data-theme="dark"] .referral-link-display { background: #1f2937; border-color: #4b5563; color: #e5e7eb; }
        [data-theme="dark"] .btn-secondary { background: #111827; color: #818cf8; border-color: #818cf8; }
        [data-theme="dark"] .referral-item { background: #111827; }
        [data-theme="dark"] .referral-info h4 { color: #e5e7eb; }
        [data-theme="dark"] .referral-info p { color: #9ca3af; }
        [data-theme="dark"] .referral-amount .status { color: #9ca3af; }
        [data-theme="dark"] .empty-state h3 { color: #e5e7eb; }
        [data-theme="dark"] .empty-state p { color: #9ca3af; }
        [data-theme="dark"] .step-card { background: #111827; border-color: #374151; }
        [data-theme="dark"] .step-card h4 { color: #e5e7eb; }
        [data-theme="dark"] .step-card p { color: #9ca3af; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Page Header -->
        <header class="page-header">
            <h1 data-translate="referralTitle">Referral Program</h1>
        </header>

        <!-- Stats Section -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon">üíµ</div>
                <div class="stat-value" id="availableBalance">0.00</div>
                <div class="stat-label" data-translate="availableBalance">Available</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìà</div>
                <div class="stat-value" id="totalEarned">0.00</div>
                <div class="stat-label" data-translate="totalEarned">Total Earned</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-value" id="referralsCount">0</div>
                <div class="stat-label" data-translate="referrals">Referrals</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value" id="pendingAmount">0.00</div>
                <div class="stat-label" data-translate="withdrawn">Withdrawn</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content-area">
            <!-- Referral Link Section -->
            <div class="referral-link-section">
                <h3 style="margin: 0 0 10px 0; font-size: 14px; font-weight: 600; color: #1f2937;" data-translate="yourLink">Your Referral Link</h3>
                <div class="referral-link-display" id="referralLinkDisplay">
                    <span data-translate="loading">Loading...</span>
                </div>
                <div class="button-group">
                    <button id="copyButton" class="btn btn-primary" data-translate="copy"><i class="fas fa-copy"></i> Copy</button>
                    <button id="shareButton" class="btn btn-secondary" data-translate="share"><i class="fas fa-share-alt"></i> Share</button>
                </div>
            </div>

            <!-- Action Cards -->
            <div class="section-title" data-translate="actions">Quick Actions</div>
            <div id="withdrawCard" class="card">
                <div class="card-content">
                    <div class="card-icon icon-purple"><i class="fas fa-wallet" style="color: #9333ea;"></i></div>
                    <div class="card-info">
                        <h3 data-translate="withdraw">Withdraw</h3>
                        <p data-translate="withdrawDesc">Cash to TON wallet</p>
                    </div>
                </div>
                <svg class="card-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
            </div>

            <div id="historyCard" class="card">
                <div class="card-content">
                    <div class="card-icon icon-blue"><i class="fas fa-history" style="color: #2563eb;"></i></div>
                    <div class="card-info">
                        <h3 data-translate="history">Transaction History</h3>
                        <p data-translate="historyDesc">View all your referrals</p>
                    </div>
                </div>
                <svg class="card-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
            </div>

            <!-- Referrals Section -->
            <div style="margin-top: 24px;">
                <div class="section-title" data-translate="myReferrals">My Referrals</div>
                <div id="noReferrals" class="empty-state">
                    <div class="empty-icon"><i class="fas fa-user-friends"></i></div>
                    <h3 data-translate="noReferrals">No Referrals Yet</h3>
                    <p data-translate="referralEmptyHint">Share your link to get started</p>
                </div>
                <div id="referralsList"></div>
            </div>

            <!-- How It Works Section -->
            <div style="margin-top: 28px; margin-bottom: 20px;">
                <div class="section-title" data-translate="howItWorks">How It Works</div>
                <div class="how-it-works">
                    <div class="step-card">
                        <div class="step-number">1</div>
                        <h4 data-translate="step1Title">Share Link</h4>
                        <p data-translate="step1Desc">Copy & share your unique link</p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">2</div>
                        <h4 data-translate="step2Title">Friend Buys</h4>
                        <p data-translate="step2Desc">They purchase 100+ stars</p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">3</div>
                        <h4 data-translate="step3Title">You Earn</h4>
                        <p data-translate="step3Desc">0.5 USDT per referral</p>
                    </div>
                    <div class="step-card">
                        <div class="step-number">4</div>
                        <h4 data-translate="step4Title">Withdraw</h4>
                        <p data-translate="step4Desc">Instant to TON wallet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Nav -->
        <div id="bottomnav-container"></div>
    </div>

    <script>
        // Initialize Telegram WebApp
        if (window.Telegram?.WebApp) {
            const webApp = window.Telegram.WebApp;
            webApp.ready();
            webApp.expand();
            document.body.classList.add('telegram-fullscreen');
        }

        const tgWebApp = window.Telegram?.WebApp;
        const tgUser = tgWebApp?.initDataUnsafe?.user;
        const BASE_API_URL = window.location.origin + '/api';
        let userId = tgUser?.id?.toString() || 'default_user_id';

        const state = {
            userId,
            referralLink: null,
            stats: { availableBalance: 0, totalEarned: 0, referralsCount: 0, pendingAmount: 0 },
            referrals: []
        };

        document.addEventListener('DOMContentLoaded', async () => {
            loadBottomNav();
            await loadReferralData();
            setupEventListeners();
            applyTranslations();
        });

        async function loadBottomNav() {
            try {
                const res = await fetch('/bottomnav.html');
                if (res.ok) {
                    document.getElementById('bottomnav-container').innerHTML = await res.text();
                    if (typeof TranslationUtils !== 'undefined') {
                        TranslationUtils.applyTranslations();
                    }
                }
            } catch (e) {
                console.error('Failed to load bottom nav:', e);
            }
        }

        async function loadReferralData() {
            try {
                const response = await fetch(`${BASE_API_URL}/referral-stats/${state.userId}`, {
                    headers: {
                        'x-telegram-init-data': tgWebApp?.initData || '',
                        'x-telegram-id': state.userId
                    }
                });

                if (!response.ok) throw new Error('Failed to load data');

                const data = await response.json();
                if (data.success) {
                    state.referralLink = data.referralLink || `https://t.me/TgStarStore_bot?start=ref_${state.userId}`;
                    state.stats = {
                        availableBalance: parseFloat(data.stats?.availableBalance || 0),
                        totalEarned: parseFloat(data.stats?.totalEarned || 0),
                        referralsCount: parseInt(data.stats?.referralsCount || 0),
                        pendingAmount: parseFloat(data.stats?.pendingAmount || 0)
                    };
                    state.referrals = data.referrals || [];
                }
            } catch (error) {
                console.error('Error loading data:', error);
                state.referralLink = `https://t.me/TgStarStore_bot?start=ref_${state.userId}`;
            }
            updateUI();
        }

        function updateUI() {
            document.getElementById('availableBalance').textContent = state.stats.availableBalance.toFixed(2);
            document.getElementById('totalEarned').textContent = state.stats.totalEarned.toFixed(2);
            document.getElementById('referralsCount').textContent = state.stats.referralsCount;
            document.getElementById('pendingAmount').textContent = state.stats.pendingAmount.toFixed(2);
            document.getElementById('referralLinkDisplay').textContent = state.referralLink;
            updateReferralsList();
        }

        function updateReferralsList() {
            const container = document.getElementById('referralsList');
            const noReferrals = document.getElementById('noReferrals');

            if (!state.referrals || state.referrals.length === 0) {
                container.innerHTML = '';
                noReferrals.style.display = 'block';
                return;
            }

            noReferrals.style.display = 'none';
            container.innerHTML = state.referrals.map(ref => `
                <div class="referral-item ${ref.status === 'pending' ? 'pending' : ''}">
                    <div class="referral-info">
                        <h4>${ref.name || 'User #' + ref.userId.substring(0, 6)}</h4>
                        <p>${new Date(ref.date).toLocaleDateString()}</p>
                    </div>
                    <div class="referral-amount">
                        <div class="amount">+0.5 USDT</div>
                        <div class="status">${ref.status}</div>
                    </div>
                </div>
            `).join('');
        }

        function setupEventListeners() {
            // Copy button
            document.getElementById('copyButton').addEventListener('click', () => {
                navigator.clipboard.writeText(state.referralLink).then(() => {
                    showToast('Link copied to clipboard!', 'success');
                });
            });

            // Share button
            document.getElementById('shareButton').addEventListener('click', () => {
                const text = `üéÅ Check out StarStore! Earn 0.5 USDT per referral.\n${state.referralLink}`;
                
                if (navigator.share) {
                    navigator.share({ title: 'StarStore Referral', text });
                } else {
                    Swal.fire({
                        title: 'Share Link',
                        html: `
                            <button style="width: 100%; padding: 12px; margin: 6px 0; background: #1f2937; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;" onclick="window.open('https://t.me/share/url?url=${encodeURIComponent(state.referralLink)}')">üì± Telegram</button>
                            <button style="width: 100%; padding: 12px; margin: 6px 0; background: #25d366; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;" onclick="window.open('https://api.whatsapp.com/send?text=${encodeURIComponent(text)}')">üí¨ WhatsApp</button>
                            <button style="width: 100%; padding: 12px; margin: 6px 0; background: #1da1f2; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;" onclick="window.open('https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}')">ùïè Twitter</button>
                        `,
                        showConfirmButton: false
                    });
                }
            });

            // Withdraw card
            document.getElementById('withdrawCard').addEventListener('click', showWithdrawPopup);

            // History card
            document.getElementById('historyCard').addEventListener('click', showTransactionHistory);
        }

        async function showWithdrawPopup() {
            const available = state.stats.availableBalance;
            if (available < 0.5) {
                Swal.fire({
                    title: '‚ö†Ô∏è Insufficient Balance',
                    text: `You need at least 0.5 USDT to withdraw. Current: ${available.toFixed(2)} USDT`,
                    icon: 'warning'
                });
                return;
            }

            const { value: formValues } = await Swal.fire({
                title: 'Withdraw Earnings',
                html: `
                    <div style="text-align: left;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1f2937;">Amount (USDT)</label>
                        <input type="number" id="amount" placeholder="0.5" max="${available}" min="0.5" step="0.5" value="0.5" style="width: 100%; padding: 10px; margin-bottom: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; background: white; color: #000;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1f2937;">TON Wallet Address</label>
                        <input type="text" id="wallet" placeholder="EQxxxxxxxxxx..." style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; background: white; color: #000;">
                        <p style="margin-top: 12px; font-size: 13px; color: #6b7280;">Available: <strong>${available.toFixed(2)} USDT</strong></p>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Withdraw',
                confirmButtonColor: '#667eea',
                preConfirm: () => {
                    const amount = document.getElementById('amount').value;
                    const wallet = document.getElementById('wallet').value;
                    if (!amount || !wallet) {
                        Swal.showValidationMessage('Please fill in all fields');
                        return false;
                    }
                    return { amount: parseFloat(amount), walletAddress: wallet };
                }
            });

            if (formValues) {
                try {
                    const res = await fetch(`${BASE_API_URL}/referral-withdrawals`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ userId: state.userId, ...formValues })
                    });
                    if (res.ok) {
                        showToast('Withdrawal requested successfully!', 'success');
                        await loadReferralData();
                    }
                } catch (e) {
                    showToast('Withdrawal failed', 'error');
                }
            }
        }

        function showTransactionHistory() {
            if (!state.referrals || state.referrals.length === 0) {
                Swal.fire({
                    title: 'Transaction History',
                    text: 'No transactions yet. Share your referral link to start earning!',
                    icon: 'info'
                });
                return;
            }

            const historyHTML = `
                <div style="text-align: left; max-height: 400px; overflow-y: auto;">
                    ${state.referrals.map(ref => `
                        <div style="padding: 10px; border-bottom: 1px solid #e5e7eb; font-size: 13px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <strong>${ref.name || 'User #' + ref.userId.substring(0, 6)}</strong>
                                <span style="color: #10b981; font-weight: 600;">+0.5 USDT</span>
                            </div>
                            <div style="color: #6b7280; font-size: 12px;">
                                ${new Date(ref.date).toLocaleDateString()} ‚Ä¢ <span style="text-transform: capitalize; font-weight: 500;">${ref.status}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            Swal.fire({
                title: 'Transaction History',
                html: historyHTML,
                icon: 'info',
                confirmButtonColor: '#667eea'
            });
        }

        function showToast(text, type) {
            const t = document.createElement('div');
            t.textContent = text;
            t.style.position = 'fixed';
            t.style.bottom = '80px';
            t.style.left = '50%';
            t.style.transform = 'translateX(-50%)';
            t.style.padding = '10px 16px';
            t.style.borderRadius = '8px';
            t.style.fontSize = '13px';
            t.style.color = '#fff';
            t.style.zIndex = '9999';
            t.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            t.style.fontWeight = '600';

            if (type === 'success') t.style.background = '#10b981';
            else if (type === 'error') t.style.background = '#dc2626';
            else t.style.background = '#667eea';

            document.body.appendChild(t);
            setTimeout(() => { t.style.opacity = '0'; t.style.transition = 'opacity .3s'; }, 1800);
            setTimeout(() => { t.remove(); }, 2100);
        }

        function applyTranslations() {
            if (typeof TranslationUtils !== 'undefined') {
                TranslationUtils.applyTranslations();
            }
        }
    </script>
    <script src="/js/version-display.js"></script>
</body>
</html>
